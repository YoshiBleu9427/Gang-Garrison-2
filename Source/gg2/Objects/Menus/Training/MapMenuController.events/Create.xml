<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<event category="CREATE" id="0">
  <actions>
    <action id="603" library="1">
      <!--action name: Code-->
      <kind>CODE</kind>
      <allowRelative>false</allowRelative>
      <question>false</question>
      <canApplyTo>true</canApplyTo>
      <actionType>CODE</actionType>
      <functionName/>
      <relative>false</relative>
      <not>false</not>
      <appliesTo>.self</appliesTo>
      <arguments>
        <argument kind="STRING">global.timeLimitMins = 15;
global.caplimit = 1;
global.respawntime = 15 * 30;

menu_create(40, 130, 500, 200, 30);

menu_addlink("Map selection -", '');

// borrowed file-search code from Port
var file, pattern, prefix, list, fp, i;

// Prefix since results from file_find_* don't include path
prefix = working_directory + "\Maps\";
pattern = prefix + "*.npc";

list = ds_list_create();
mapList = ds_list_create();

// Find files in Maps folder
for (file = file_find_first(pattern, 0); file != ""; file = file_find_next())
{
    ds_list_add(list, file);
}

// Do logic with these files
for (i = 0; i &lt; ds_list_size(list); i += 1)
{
    // Check that there are both a npc and a png file
    var mapName, mapExists;
    file = ds_list_find_value(list, i);
    mapName = string_copy(file, 1, string_length(file) - 4);
    mapExists = false;
    if(file_find_first(prefix + mapName + "*.png", 0) != "") {
        mapExists = true;
    } else if(file_find_first(prefix + mapName + "*.PNG", 0) != "") {
        mapExists = true;
    }
    
    
    // Link the map prefix to the class it is made for
    if(mapExists) {
        if("run" == string_copy(mapName, 1, 3)) {
            if(global.class == CLASS_SCOUT)
                menu_addmap(mapName);
        } else if("fir" == string_copy(mapName, 1, 3)) {
            if(global.class == CLASS_PYRO)
                menu_addmap(mapName);
        } else if("roc" == string_copy(mapName, 1, 3)) {
            if(global.class == CLASS_SOLDIER)
                menu_addmap(mapName);
        } else if("ove" == string_copy(mapName, 1, 3)) {
            if(global.class == CLASS_HEAVY)
                menu_addmap(mapName);
        } else if("det" == string_copy(mapName, 1, 3)) {
            if(global.class == CLASS_DEMOMAN)
                menu_addmap(mapName);
        } else if("eng" == string_copy(mapName, 1, 3)) {
            if(global.class == CLASS_ENGINEER)
                menu_addmap(mapName);
        } else if("hea" == string_copy(mapName, 1, 3)) {
            if(global.class == CLASS_MEDIC)
                menu_addmap(mapName);
        } else if("inf" == string_copy(mapName, 1, 3)) {
            if(global.class == CLASS_SPY)
                menu_addmap(mapName);
        } else if("rif" == string_copy(mapName, 1, 3)) {
            if(global.class == CLASS_SNIPER)
                menu_addmap(mapName);
        } else if("quo" == string_copy(mapName, 1, 3)) {
            if(global.class == CLASS_QUOTE)
                menu_addmap(mapName);
        } else {
            // no prefix? Any class will do
            menu_addmap(mapName);
        }
    }
}

// Add default maps 
menu_addmap("spy_conflict");
menu_addmap("medic_lumberyard");
menu_addmap("heavy_dirtbowl");

menu_addback("Back", '
    instance_create(x,y,CharacterMenuController);
    instance_destroy();
');
</argument>
      </arguments>
    </action>
  </actions>
</event>
