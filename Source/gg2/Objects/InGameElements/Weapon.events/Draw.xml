<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<event category="DRAW" id="0">
  <actions>
    <action id="603" library="1">
      <!--action name: Code-->
      <kind>CODE</kind>
      <allowRelative>false</allowRelative>
      <question>false</question>
      <canApplyTo>true</canApplyTo>
      <actionType>CODE</actionType>
      <functionName/>
      <relative>false</relative>
      <not>false</not>
      <appliesTo>.self</appliesTo>
      <arguments>
        <argument kind="STRING">if (distance_to_point(view_xview + view_wview/2, view_yview + view_hview/2) &gt; 800)
    exit;
    
var imageOffset;
if ((alarm[6] &lt;= 0 and alarm[5] &lt;= 0) or object_index == Blade) {
    //if we are not shooting or recoiling
    imageOffset = owner.team;
} else {
    //Play the current animation normally
    var animLength;
    if (object_index != Rifle &amp;&amp; alarm[5] &lt;= 0)
        animLength = recoilAnimLength;
    else if (sprite_index == recoilSprite)
        animLength = recoilAnimLength;
    else
        animLength = reloadAnimLength;
        
    imageOffset = floor(image_index mod animLength) + animLength*owner.team;
}

if (!owner.invisible and !owner.taunting and !owner.omnomnomnom and !owner.player.humiliated)
{
    if (!owner.cloak){
        image_alpha = power(owner.cloakAlpha, 0.5);
    }else{
        image_alpha = power(owner.cloakAlpha, 2);
    }
    
    if golden==1{
        if global.useCustomHaxxyColor==1 and owner==global.myself.object and global.haxxyColorSelection!=2{
            _color=make_color_rgb(global.myHaxxyColorR,global.myHaxxyColorG,global.myHaxxyColorB)
        }else{
            _color=c_white
        }
    }else{
        _color=c_white
    }
    
    if global.weaponDraw==1 and !owner.cloak{
        if owner==global.myself.object{
            if keyboard_check(global.attack) or mouse_check_button(mb_left) or keyboard_check(global.special) or mouse_check_button(mb_right){
                image_alpha=1
            }else{
                image_alpha=0
            }
        }
    }
    
    if owner==global.myself.object and object_index == Blade and owner.canBubble==1{
        mouseDir=point_direction(view_xview[0]+view_wview[0]/2, view_yview[0]+view_hview[0]/2, mouse_x, mouse_y)
        draw_set_color(c_gray)
        draw_set_alpha(0.4)
        draw_line_width(x,y,x+lengthdir_x(min(150,owner.aimDistance),mouseDir),y+lengthdir_y(min(150,owner.aimDistance),mouseDir),2)
        //draw_circle(x+lengthdir_x(min(150,owner.aimDistance),owner.aimDirection),y+lengthdir_y(min(150,owner.aimDistance),owner.aimDirection),10,1)
        //draw_rectangle(x+lengthdir_x(min(150,owner.aimDistance),owner.aimDirection)-5,y+lengthdir_y(min(150,owner.aimDistance),owner.aimDirection)-5,x+lengthdir_x(min(150,owner.aimDistance),owner.aimDirection)+5,y+lengthdir_y(min(150,owner.aimDistance),owner.aimDirection)+5,1)
        //draw_set_color(c_white)
        draw_sprite_ext(OldBubbleS,0,x+lengthdir_x(min(150,owner.aimDistance),mouseDir),y+lengthdir_y(min(150,owner.aimDistance),mouseDir),1,1,0,c_white,0.5)
        draw_set_alpha(1)
    }
    
    draw_sprite_ext(sprite_index, imageOffset, round(x+xoffset*image_xscale), round(y+yoffset) + owner.equipmentOffset, image_xscale, image_yscale, image_angle, _color /*c_white*/, image_alpha);
    if (owner.ubered){
        if (owner.team == TEAM_RED){
            ubercolour = c_red;
        }else if (owner.team == TEAM_BLUE){
            ubercolour = c_blue;
        }
        draw_sprite_ext(sprite_index, imageOffset, round(x+xoffset*image_xscale), round(y+yoffset) + owner.equipmentOffset, image_xscale, image_yscale, image_angle, ubercolour, 0.7*image_alpha);
    }
    if owner.graceAnimation==2{
        if (owner.team == TEAM_RED){
            ubercolour = c_red;
        }else if (owner.team == TEAM_BLUE){
            ubercolour = c_blue;
        }
        draw_sprite_ext(sprite_index, imageOffset, round(x+xoffset*image_xscale), round(y+yoffset) + owner.equipmentOffset, image_xscale, image_yscale, image_angle, ubercolour, 0.7*image_alpha);
    }
}
</argument>
      </arguments>
    </action>
  </actions>
</event>
